""" 
To do:
Setup leaderboard of event counts
Flag risky logins
Set logon hours?

"""


import os

file = 'logs.txt'

def parse_logs(file):
    
    failed_logins = dict()
    successful_logins = dict()
    file_access = dict()
    logoff = dict()
    with open(file, 'r') as f:
        for line in f:
            parts = line.strip().split(',')
            time = parts[0]
            user = parts[1]
            ip = parts[2]
            event = parts[3]
            match event:
                case 'LOGON':
                    successful_logins[user] = successful_logins.get(user, 0) + 1
                case 'LOGON_FAILED':
                    failed_logins[user] = failed_logins.get(user, 0) + 1
                case 'LOGOFF':
                    logoff[user] = logoff.get(user, 0) + 1
                case 'FILE_ACCESS':
                    file_access[user] = file_access.get(user, 0) + 1
    
    sorted_failed = dict(sorted(failed_logins.items(), key=lambda x: x[1], reverse=True))
    sorted_success = dict(sorted(successful_logins.items(), key=lambda x: x[1], reverse=True))
    sorted_file = dict(sorted(file_access.items(), key=lambda x: x[1], reverse=True))
    sorted_logoff = dict(sorted(logoff.items(), key=lambda x: x[1], reverse=True))
    
    flagged_level = 5
    flagged_users = []
    
    for user in failed_logins:
        if failed_logins[user] >= flagged_level:
            flagged_users.append(user)
            
    for u in flagged_users:
        print(f'{u} has had 5 or more failed logins. Flagged as suspicious!\n')
    
    for u, count in sorted_failed.items():
        print(f'{u} had {count} failed logins')
    for u, count in sorted_success.items():
        print(f'{u} had {count} successful logins')
    for u, count in sorted_file.items():
        print(f'{u} had {count} file accesses')
    for u, count in sorted_logoff.items():
        print(f'{u} had {count} logoffs')    

    
    


parse_logs(file)